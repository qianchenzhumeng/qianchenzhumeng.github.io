<!DOCTYPE html><html lang="zh-CN" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="pv-cache-enabled" content="false"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="嵌入式系统程序占用空间大小分析方法" /><meta name="author" content="前尘逐梦" /><meta property="og:locale" content="zh_CN" /><meta name="description" content="MCU 上的内存资源、flash 资源通常都比较紧张，有可能会因程序占用空间过大在编译、烧录、运行时出现莫名其妙的问题。本文以 STM8L151x4/6 和 Arduino UNO 为例，介绍 MCU 程序占用空间大小的分析方法。" /><meta property="og:description" content="MCU 上的内存资源、flash 资源通常都比较紧张，有可能会因程序占用空间过大在编译、烧录、运行时出现莫名其妙的问题。本文以 STM8L151x4/6 和 Arduino UNO 为例，介绍 MCU 程序占用空间大小的分析方法。" /><link rel="canonical" href="https://qianchenzhumeng.github.io/posts/memory_footprint_analysis_method_for_embedded_systems/" /><meta property="og:url" content="https://qianchenzhumeng.github.io/posts/memory_footprint_analysis_method_for_embedded_systems/" /><meta property="og:site_name" content="前尘逐梦" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-07-25T07:59:00+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="嵌入式系统程序占用空间大小分析方法" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"前尘逐梦"},"description":"MCU 上的内存资源、flash 资源通常都比较紧张，有可能会因程序占用空间过大在编译、烧录、运行时出现莫名其妙的问题。本文以 STM8L151x4/6 和 Arduino UNO 为例，介绍 MCU 程序占用空间大小的分析方法。","headline":"嵌入式系统程序占用空间大小分析方法","dateModified":"2021-07-25T07:59:00+08:00","datePublished":"2021-07-25T07:59:00+08:00","url":"https://qianchenzhumeng.github.io/posts/memory_footprint_analysis_method_for_embedded_systems/","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://qianchenzhumeng.github.io/posts/memory_footprint_analysis_method_for_embedded_systems/"},"@context":"https://schema.org"}</script><title>嵌入式系统程序占用空间大小分析方法 | 前尘逐梦</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://cdn.jsdelivr.net/gh/cotes2020/chirpy-images/commons/avatar.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">前尘逐梦</a></div><div class="site-subtitle font-italic"></div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/qianchenzhumeng" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['qianchenzhumeng','live.cn'].join('@')" aria-label="email" class="order-4" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-5" > <i class="fas fa-rss"></i> </a> <a href="https://www.thingiverse.com/mikeyu/designs" aria-label="" class="order-6" target="_blank" rel="noopener"> <i class="fas fa-cube"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>嵌入式系统程序占用空间大小分析方法</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>嵌入式系统程序占用空间大小分析方法</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Sun, Jul 25, 2021, 7:59 AM +0800" > Jul 25, 2021 <i class="unloaded">2021-07-25T07:59:00+08:00</i> </span> by <span class="author"> 前尘逐梦 </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1588 words">8 min</span></div></div><div class="post-content"><h2 id="1-概述">1. 概述</h2><p>MCU 上的内存资源、flash 资源通常都比较紧张，程序比较复杂的时候，有可能会出现程序 RAM 或 flash 占用空间过大，导致系统运行不稳定（比如栈和堆空间冲突导致程序出现莫名其妙或者复位的问题），甚至是大小超过硬件资源限制，导致编译、烧录失败的问题。</p><p>分析的基本方法大概有两种，一种是分析映射文件（*.map)，统计各个段的大小，另一种是从最终生成的可执行可链接文件（*.elf）中读取相关信息。</p><h2 id="2-查看整个程序的占用空间">2. 查看整个程序的占用空间</h2><h3 id="1-stm8l151x46">(1) STM8L151x4/6</h3><p>以 STM8L151x4/6 为例，介绍第一种方法。</p><p>首先要获取映射文件。以 ST Visual Develop 为例，打开项目配置，在 <code class="language-plaintext highlighter-rouge">Linker</code> 选项卡中，将 <code class="language-plaintext highlighter-rouge">Category</code> 切换为 <code class="language-plaintext highlighter-rouge">Output</code>，在 <code class="language-plaintext highlighter-rouge">Map</code> 一栏勾选 <code class="language-plaintext highlighter-rouge">Generate Map File</code>，这样配置之后，编译时就可以生成映射文件了，例如 client.map。</p><p>下面的内容是 client.map 文件中的 <code class="language-plaintext highlighter-rouge">Segments</code> 部分。</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre>                               --------
                               Segments
                               --------

start 00008080 end 0000820d length   397 segment .const
start 00008251 end 0000bfb7 length 15718 segment .text
start 00001000 end 00001000 length     0 segment .eeprom
start 00000000 end 00000000 length     0 segment .bsct
start 00000000 end 0000000a length    10 segment .ubsct
start 0000000a end 0000000a length     0 segment .bit
start 0000000a end 0000000a length     0 segment .share
start 00000100 end 0000013c length    60 segment .data, initialized
start 00008215 end 00008251 length    60 segment .data, from
start 0000013c end 0000052e length  1010 segment .bss
start 00000000 end 00002564 length  9572 segment .info.
start 00000000 end 00016f1d length 93981 segment .debug
start 00008000 end 00008080 length   128 segment .const
start 0000820d end 00008215 length     8 segment .init
</pre></table></code></div></div><p>先来看 flash 使用情况。STM8L151x4/6，从 0x8000 地址开始后的空间全部是 flash 空间（可以在芯片数据手册中找到），那么，从上面的内容可以看出，<code class="language-plaintext highlighter-rouge">.const</code> 段、<code class="language-plaintext highlighter-rouge">.text</code> 段、<code class="language-plaintext highlighter-rouge">.data</code> 段、<code class="language-plaintext highlighter-rouge">.init</code> 段占 flash 空间共计 16311 字节。<code class="language-plaintext highlighter-rouge">.const</code> 被分为两段是是因为 flash 的 0x8000~0x807f 是专门用来放复位和中断向量表的。</p><p>再来看 RAM 使用情况。STM8L151x4/6 的 RAM 地址段为 0x0000~0x07ff，所以，<code class="language-plaintext highlighter-rouge">.bsct</code> 段、<code class="language-plaintext highlighter-rouge">.ubsct</code> 段、<code class="language-plaintext highlighter-rouge">.bit</code> 段、<code class="language-plaintext highlighter-rouge">.share</code> 段、<code class="language-plaintext highlighter-rouge">.data</code> 段、<code class="language-plaintext highlighter-rouge">.bss</code> 段占 RAM 空间共计 1080 字节。</p><p>除了用来分析程序的占用空间，MAP 文件还可以有其他用途。例如，map 文件中 <code class="language-plaintext highlighter-rouge">Stack usage</code> 部分包含栈的使用信息：</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>                             -----------
                             Stack usage
                             -----------
// 省略
Stack size: 309
</pre></table></code></div></div><p>栈区位于 RAM 中（共 513 字节，栈底从 RAM 的截至地址 0x07ff 开始，即 0x05fe~0x07ff 为栈区）。</p><h3 id="2-arduino-uno">(2) Arduino UNO</h3><p>以 Arduino UNO 为例，介绍第二种方法。</p><p>首先要获取 ELF（Executable and Linking Format） 文件。打开 Arduino IDE 首选项设置，在 <code class="language-plaintext highlighter-rouge">Show verbose output during</code> 一行，勾选 <code class="language-plaintext highlighter-rouge">compile</code>，这样可以在从编译的输出中找到所需的所有信息，包括交叉编译工具链路径以及目标文件输出目录（编译完成后从该目录中找到后缀为 elf 的文件）。</p><p>接下来，使用交叉编译工具链提供的工具，从 elf 文件获取所需信息。</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre>:: 查看各个段的大小
c:\&gt;C:\Users\lenovo\AppData\Local\Arduino15\packages\arduino\tools\avr-gcc\7.3.0-atmel3.6.1-arduino7\bin\avr-size.exe -A C:\Users\lenovo\AppData\Local\Temp\arduino-sketch-D09F94A05940FB868995B43A5A7E8200\sketch_example1.ino.elf
:: 输出
C:\Users\lenovo\AppData\Local\Temp\arduino-sketch-D09F94A05940FB868995B43A5A7E8200\sketch_example1.ino.elf  :
section                     size      addr
.data                         22   8388864
.text                       4384         0
.bss                        1659   8388886
.comment                      17         0
.note.gnu.avr.deviceinfo      64         0
.debug_aranges               208         0
.debug_info                11541         0
.debug_abbrev               3127         0
.debug_line                 3898         0
.debug_frame                 820         0
.debug_str                  3076         0
.debug_loc                  5607         0
.debug_ranges                536         0
Total                      34959
</pre></table></code></div></div><p>首先来看一下 RAM 使用情况。<code class="language-plaintext highlighter-rouge">.data</code> 段存储的是<u>**初始化过**</u>的全局变量、<u>**初始化过**</u>的静态变量（包括全局静态变量和局部静态变量），共计 22 字节。<code class="language-plaintext highlighter-rouge">.bss</code> 段存储的是<u>**未初始化**</u>的全局变量、<u>**未初始化**</u>过的静态变量（包括全局静态变量和局部静态变量），二者加起来总共有 1681 字节，运行时，都会放到 RAM 中。按 Arduino UNO 的规格，RAM 有 2K，除去全局变量占用的 1681 字节，局部变量最多只能使用 367 字节。</p><p>接下来看一下 flash 使用情况。<code class="language-plaintext highlighter-rouge">.txt</code> 段存储的是程序执行代码，储存在 flash 中，有 4384 字节。除此以外，<code class="language-plaintext highlighter-rouge">.data</code> 段也会保存在 flash（<code class="language-plaintext highlighter-rouge">.bss</code> 段不占用 flash 空间）。<code class="language-plaintext highlighter-rouge">.txt</code> 和 <code class="language-plaintext highlighter-rouge">.data</code> 共占用 flash 中的 4406 字节。</p><p>从测试情况看，常量比较复杂，全局常量位于 <code class="language-plaintext highlighter-rouge">.data</code> 段。局部常量随着初值的不同，会影响 <code class="language-plaintext highlighter-rouge">.data</code> 段和 <code class="language-plaintext highlighter-rouge">.txt</code> 段。</p><p>各个段的含义可以参考这边博文：«<a href="https://www.cs-fundamentals.com/c-programming/memory-layout-of-c-program-code-data-segments">Memory Layout of C Program</a>»。</p><h2 id="3-查看函数变量常量的占用空间">3. 查看函数、变量、常量的占用空间</h2><h3 id="1-stm8l151x46-1">(1) STM8L151x4/6</h3><p>每个符号占用的空间可以在在映射文件的 <code class="language-plaintext highlighter-rouge">Symbols</code> 部分找到。</p><h3 id="2-arduino-uno-1">(2) Arduino UNO</h3><p>这部分参考了 «<a href="https://blog.benoitblanchon.fr/arduino-code-size-and-assembly/">[Arduino] View code size and assembly code</a>»。</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
</pre><td class="rouge-code"><pre>:: 按占用空间的大小从大到小打印符号名称
c:\&gt;C:\Users\lenovo\AppData\Local\Arduino15\packages\arduino\tools\avr-gcc\7.3.0-atmel3.6.1-arduino7\bin\avr-nm.exe --size-sort -C -r C:\Users\lenovo\AppData\Local\Temp\arduino-sketch-D09F94A05940FB868995B43A5A7E8200\sketch_example1.ino.elf
:: 输出
000009a2 T main
00000400 b payloads_ring_buffer
000001cd b min_ctx
00000134 t on_wire_bytes(min_context*, unsigned char, unsigned char, unsigned char const*, unsigned int, unsigned int, unsigned char) [clone .constprop.14]
0000009d b Serial
0000009a t HardwareSerial::write(unsigned char)
00000094 T __vector_16
00000070 t stuffed_tx_byte(min_context*, unsigned char, bool) [clone .constprop.15]
00000064 T __vector_18
00000060 t crc32_step(crc32_context*, unsigned char)
0000005a t Print::write(unsigned char const*, unsigned int)
0000005a t _GLOBAL__sub_I___vector_18
0000004c t min_application_handler(unsigned char, unsigned char const*, unsigned char, unsigned char) [clone .constprop.8]
0000004c T __vector_19
00000048 t send_ack(min_context*) [clone .part.3] [clone .constprop.12]
00000048 t transport_fifo_send(min_context*, transport_frame*) [clone .constprop.13]
00000044 t HardwareSerial::_tx_udr_empty_irq()
00000040 t HardwareSerial::flush()
00000028 t HardwareSerial::read()
0000001e t HardwareSerial::availableForWrite()
0000001c t HardwareSerial::peek()
00000018 t millis
00000018 t HardwareSerial::available()
00000016 T __do_global_ctors
00000016 T __do_copy_data
00000014 t Serial0_available()
00000014 t serialEventRun()
00000012 d vtable for HardwareSerial
00000010 T __do_clear_bss
0000000c T __tablejump2__
00000004 b timer0_overflow_count
00000004 b timer0_millis
00000004 b last_sent
00000004 b now
00000001 b timer0_fract
</pre></table></code></div></div><h2 id="4-总结">4. 总结</h2><p>两种分析程序占用空间的方法，一种是分析映射文件（*.map)，统计各个段的大小，另一种是从最终生成的可执行可链接文件（*.elf）中读取相关信息。第一种方法需要手动去统计，优点是结合数据手册分析会比较直观，缺点是比较麻烦。如果交叉编译工具链包含了解读二进制文件的工具，例如本文用到的 <code class="language-plaintext highlighter-rouge">avr-size</code>，使用第二种方法会比较方便。</p><h2 id="参考">参考</h2><p>[1] <a href="https://www.cs-fundamentals.com/c-programming/memory-layout-of-c-program-code-data-segments">https://www.cs-fundamentals.com/c-programming/memory-layout-of-c-program-code-data-segments</a></p><p>[2] <a href="https://blog.benoitblanchon.fr/arduino-code-size-and-assembly/">https://blog.benoitblanchon.fr/arduino-code-size-and-assembly/</a></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/embedded/'>Embedded</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/mcu/" class="post-tag no-text-decoration" >MCU</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=嵌入式系统程序占用空间大小分析方法 - 前尘逐梦&url=https://qianchenzhumeng.github.io/posts/memory_footprint_analysis_method_for_embedded_systems/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=嵌入式系统程序占用空间大小分析方法 - 前尘逐梦&u=https://qianchenzhumeng.github.io/posts/memory_footprint_analysis_method_for_embedded_systems/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=嵌入式系统程序占用空间大小分析方法 - 前尘逐梦&url=https://qianchenzhumeng.github.io/posts/memory_footprint_analysis_method_for_embedded_systems/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://qianchenzhumeng.github.io/posts/memory_footprint_analysis_method_for_embedded_systems/" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <a href="http://service.weibo.com/share/share.php?title=嵌入式系统程序占用空间大小分析方法 - 前尘逐梦&url=https://qianchenzhumeng.github.io/posts/memory_footprint_analysis_method_for_embedded_systems/" data-toggle="tooltip" data-placement="top" title="Weibo" target="_blank" rel="noopener" aria-label="Weibo"> <i class="fa-fw fab fa-weibo"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/mq-r-f133_develop_guide/">芒果派 MQ-R F133 开发指南</a><li><a href="/posts/gui_development_with_rust_and_gtk4_on_windows/">Windows 下使用 Rust 和 GTK4 创建 GUI 程序</a><li><a href="/posts/modern_robotics_mechanics_planning_and_Control/">Modern Robotics: Mechanics, Planning, and Control</a><li><a href="/posts/rust_notes/">Rust 笔记</a><li><a href="/posts/generate_manufacturing_data_from_eagle/">Eagle 输出 PCB 制造数据</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/mqtt/">MQTT</a> <a class="post-tag" href="/tags/openwrt/">OpenWrt</a> <a class="post-tag" href="/tags/rust/">Rust</a> <a class="post-tag" href="/tags/thingsboard/">ThingsBoard</a> <a class="post-tag" href="/tags/contiki/">Contiki</a> <a class="post-tag" href="/tags/esp8266/">ESP8266</a> <a class="post-tag" href="/tags/stm8/">STM8</a> <a class="post-tag" href="/tags/inventory-management/">Inventory Management</a> <a class="post-tag" href="/tags/iot/">IoT</a> <a class="post-tag" href="/tags/other/">Other</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/compile_openwrt_for_mt7688/"><div class="card-body"> <span class="timeago small" > Aug 28, 2021 <i class="unloaded">2021-08-28T08:00:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>OpenWrt 编译</h3><div class="text-muted small"><p> 1. 背景 处理器：MT7688 OpenWrt版本：19.07.2 编译环境：wsl（Ubuntu 20.04.1 LTS） 2. 下载源码 源码地址：https://github.com/openwrt/openwrt 可以通过 gitee 加速代码下载，具体做法是在 gitee 上通过“从GitHub/GitLab导入仓库”的形式创建仓库，等创建好后，从 git...</p></div></div></a></div><div class="card"> <a href="/posts/IAR%E7%BC%96%E8%AF%91ZStack-CC2530%E7%94%9F%E6%88%90HEX%E6%96%87%E4%BB%B6/"><div class="card-body"> <span class="timeago small" > Aug 25, 2015 <i class="unloaded">2015-08-25T00:11:26+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>IAR 编译 ZStack-CC2530 生成 HEX 文件</h3><div class="text-muted small"><p> IAR 编译 ZStack-CC2530 为可下载运行的 HEX 文件的正确配置： 正确配置输出文件格式：菜单选择Project－Options－Linker－Output－Format，选择Other。右边的Output下拉框选intel-extended，Format variant下拉框选None，Module-local下拉框选Include all ...</p></div></div></a></div><div class="card"> <a href="/posts/Qt_Embedded(4.8.6)%E4%BA%A4%E5%8F%89%E7%BC%96%E8%AF%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/"><div class="card-body"> <span class="timeago small" > Aug 25, 2015 <i class="unloaded">2015-08-25T00:11:26+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Qt/Embeded(4.8.6)交叉编译环境搭建</h3><div class="text-muted small"><p> 目标板为树莓派，安装镜像为：2014-12-24-wheezy-raspbian.img 安装交叉编译器： 下载：gcc-linaro-arm-linux-gnueabihf-raspbian-x64 解压后将bin目录添加进~/.profile文件中，例如： PATH=/home/qianchen/rpi/tools/arm-bcm2708/gcc-linaro-arm-linu...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/rust_notes/" class="btn btn-outline-primary" prompt="Older"><p>Rust 笔记</p></a> <a href="/posts/compile_openwrt_for_mt7688/" class="btn btn-outline-primary" prompt="Newer"><p>OpenWrt 编译</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://github.com/qianchenzhumeng">前尘逐梦</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/mqtt/">MQTT</a> <a class="post-tag" href="/tags/openwrt/">OpenWrt</a> <a class="post-tag" href="/tags/rust/">Rust</a> <a class="post-tag" href="/tags/thingsboard/">ThingsBoard</a> <a class="post-tag" href="/tags/contiki/">Contiki</a> <a class="post-tag" href="/tags/esp8266/">ESP8266</a> <a class="post-tag" href="/tags/stm8/">STM8</a> <a class="post-tag" href="/tags/inventory-management/">Inventory Management</a> <a class="post-tag" href="/tags/iot/">IoT</a> <a class="post-tag" href="/tags/other/">Other</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script> var _hmt = _hmt || []; (function() { var hm = document.createElement("script"); hm.src = "https://hm.baidu.com/hm.js?0dfbba74f4bbf4feedaaf402fbae1dd8"; var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s); })(); </script> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://qianchenzhumeng.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
