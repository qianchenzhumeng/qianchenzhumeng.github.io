<!DOCTYPE html><html lang="zh-CN" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="pv-cache-enabled" content="false"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="Keil HEX 文件格式解析及数据提取" /><meta name="author" content="前尘逐梦" /><meta property="og:locale" content="zh_CN" /><meta name="description" content="本文以 MCU OTA 升级为背景，对 Intel HEX 文件格式以及 Keil 输出内存数据的方式进行简单介绍，并提供 Intel HEX 文件以及 BIN 文件数据提取示例程序。" /><meta property="og:description" content="本文以 MCU OTA 升级为背景，对 Intel HEX 文件格式以及 Keil 输出内存数据的方式进行简单介绍，并提供 Intel HEX 文件以及 BIN 文件数据提取示例程序。" /><link rel="canonical" href="https://qianchenzhumeng.github.io/posts/keil_hex_file_format/" /><meta property="og:url" content="https://qianchenzhumeng.github.io/posts/keil_hex_file_format/" /><meta property="og:site_name" content="前尘逐梦" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-02-13T21:15:00+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Keil HEX 文件格式解析及数据提取" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"前尘逐梦"},"description":"本文以 MCU OTA 升级为背景，对 Intel HEX 文件格式以及 Keil 输出内存数据的方式进行简单介绍，并提供 Intel HEX 文件以及 BIN 文件数据提取示例程序。","headline":"Keil HEX 文件格式解析及数据提取","dateModified":"2022-02-13T21:15:00+08:00","datePublished":"2022-02-13T21:15:00+08:00","url":"https://qianchenzhumeng.github.io/posts/keil_hex_file_format/","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://qianchenzhumeng.github.io/posts/keil_hex_file_format/"},"@context":"https://schema.org"}</script><title>Keil HEX 文件格式解析及数据提取 | 前尘逐梦</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://cdn.jsdelivr.net/gh/cotes2020/chirpy-images/commons/avatar.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">前尘逐梦</a></div><div class="site-subtitle font-italic"></div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/qianchenzhumeng" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['qianchenzhumeng','live.cn'].join('@')" aria-label="email" class="order-4" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-5" > <i class="fas fa-rss"></i> </a> <a href="https://www.thingiverse.com/mikeyu/designs" aria-label="" class="order-6" target="_blank" rel="noopener"> <i class="fas fa-cube"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Keil HEX 文件格式解析及数据提取</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Keil HEX 文件格式解析及数据提取</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Sun, Feb 13, 2022, 9:15 PM +0800" > Feb 13 <i class="unloaded">2022-02-13T21:15:00+08:00</i> </span> by <span class="author"> 前尘逐梦 </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2342 words">13 min</span></div></div><div class="post-content"><h2 id="1-背景">1. 背景</h2><p>进行 MCU OTA 升级调试时，升级重启后，MCU 程序跑飞，怀疑程序下载缓冲区的内容被改写，为了排除这个疑点，需要将缓冲区内的数据与编译生成的 BIN 文件或 HEX 文件内的数据进行比对。思路是将数据以文本形式输出到文件中，使用文件比对工具进行比对。</p><p>Keil 的 <code class="language-plaintext highlighter-rouge">SAVE</code> 调试命令会将下载缓冲区中的数据输出到 Intel HEX 格式<a href="https://developer.arm.com/documentation/ka003292/latest">[1]</a>的文件中，虽然编译生成的 <code class="language-plaintext highlighter-rouge">*.hex</code> 文件也是该格式，但是二者有时不能直接对比：前者的地址会从 <code class="language-plaintext highlighter-rouge">0x0000</code> 开始，但是编译生成的 <code class="language-plaintext highlighter-rouge">*.hex</code> 文件内记录的起始地址与实际指定的程序烧录地址有关，但是数据是一样的。因此，需要从这两个文件中分别提取数据进行比对。如果是 BIN 文件，仅包含二进制数据，可以将数据提取出来，以同样的文本形式输出到文件中进行比对。</p><h2 id="2-文件格式">2. 文件格式</h2><h3 id="1-intel-hex-文件格式">(1) Intel HEX 文件格式</h3><p>Keil 生成的 Intel HEX 文件中，每一行都是一条 HEX 记录，形如：</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>:llaaaatt[dd...]cc
</pre></table></code></div></div><p>每条记录的格式如下<a href="https://developer.arm.com/documentation/ka003292/latest">[1]</a>：</p><ul><li><code class="language-plaintext highlighter-rouge">:</code> 每条记录都以冒号开始.<li><code class="language-plaintext highlighter-rouge">ll</code> 是“记录长度”字段，表示该条记录中“数据”字段（dd）占多少字节。<li><code class="language-plaintext highlighter-rouge">aaaa</code> 是“地址”字段，表示该条记录中，“数据”字段所在的起始地址。<li><code class="language-plaintext highlighter-rouge">tt</code> 是“类型”字段，表示该条记录的类型，有如下值： <strong>00</strong> - 数据（data） <strong>01</strong> - 文件结束（end-of-file） <strong>02</strong> - 扩展段地址（extended segment address） <strong>04</strong> - 扩展线性地址（extended linear address） <strong>05</strong> - 开始线性地址（start linear address），仅 MDK-ARM 使用<li><code class="language-plaintext highlighter-rouge">dd</code> 是“数据”字段，表示一个字节的数据。一条记录中可能有多个字节的数据，长度由 <code class="language-plaintext highlighter-rouge">ll</code> 字段指定。<li><code class="language-plaintext highlighter-rouge">cc</code> 是记录的校验和。</ul><p>Keil 输出的 HEX 文件，每条记录最多包含 16 字节的数据，例如：</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>:10100000D0BC01208D420008978300084D70000875
</pre></table></code></div></div><h3 id="2-bin-文件格式">(2) BIN 文件格式</h3><p>BIN 文件其实没有格式。</p><h2 id="3-数据提取示例代码">3. 数据提取示例代码</h2><h3 id="1-提取-hex-文件内的数据">(1) 提取 HEX 文件内的数据</h3><p>接下来给出一段提取 HEX 文件内容的程序，该程序逐行读取 HEX 文件，如果遇到类型为“数据”的记录，则将该记录中的“数据”字段提取出来，以十六进制 ASCII 字符的形式输出到另一个文件中。</p><div class="language-c highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
</pre><td class="rouge-code"><pre><span class="cm">/**
 * @file hex_tool.c
 * @author qianchenzhumeng (qianchenzhumeng@live.cn)
 * @brief 从 Intel HEX 文件中提取数据，以 ASCII 文本的形式输出到指定文件中。
 * @version 0.1
 * @date 2022-02-12
 * 
 * @copyright Copyright (c) 2022 qianchenzhumeng
 * 
 */</span>
<span class="cp">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
#include &lt;stdint.h&gt;
</span>
<span class="cm">/* Inter HEX 文件格式描述：
 *  : 每条记录都以冒号开始.
 *  ll 是“记录长度”字段，表示该条记录中“数据”字段（dd）占多少字节。
 *  aaaa`是“地址”字段，表示该条记录中，“数据”字段所在的起始地址。
 *  tt 是“类型”字段，表示该条记录的类型，有如下值：
 *    00 - 数据（data）
 *    01 - 文件结束（end-of-file）
 *    02 - 扩展段地址（extended segment address）
 *    04 - 扩展线性地址（extended linear address）
 *    05 - 开始线性地址（start linear address），仅 MDK-ARM 使用
 *  dd 是“数据”字段，表示一个字节的数据。一条记录中可能有多个字节的数据，长度由 `ll` 字段指定。
 *  cc 是记录的校验和。
 */</span>

<span class="cm">/**
 * @brief 记录类型
 * 
 */</span>
<span class="k">typedef</span> <span class="k">enum</span> <span class="n">xRECORD_TYPE</span>
<span class="p">{</span>
    <span class="n">eData</span><span class="p">,</span>
    <span class="n">eEOF</span><span class="p">,</span>
    <span class="n">eExtendedSegmentAddress</span><span class="p">,</span>
    <span class="n">eExtendedLineAddress</span><span class="p">,</span>
    <span class="n">eStartLinearAddress</span>
<span class="p">}</span><span class="n">xRecordType_t</span><span class="p">;</span>

<span class="cm">/**
 * @brief 行信息
 * 
 */</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">xHEX_80_LINE_INFO</span>
<span class="p">{</span>
    <span class="cm">/*  LL AAAA TT DDDD CC*/</span>
    <span class="cm">/* :02 0000 04 2000 DA */</span>
    <span class="cm">/*  LL AAAA TT DDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDD CC*/</span>
    <span class="cm">/* :10 1000 00 D0BC01208D420008978300084D700008 75 */</span>
    <span class="kt">uint8_t</span> <span class="n">u8Length</span><span class="p">;</span>
    <span class="kt">uint16_t</span> <span class="n">u16Address</span><span class="p">;</span>
    <span class="kt">uint8_t</span> <span class="n">u8RecordType</span><span class="p">;</span>
    <span class="kt">uint8_t</span> <span class="n">u8CheckSum</span><span class="p">;</span>
<span class="p">}</span><span class="n">xHexLineInfo_t</span><span class="p">;</span>

<span class="cp">#define LINE_MAX_LENGTH (1024)
</span><span class="kt">char</span> <span class="n">acLineData</span><span class="p">[</span><span class="n">LINE_MAX_LENGTH</span><span class="p">];</span>

<span class="cm">/**
 * @brief 解析 HEX 行数据，要保证传给该函数的行数据是有效的 HEX 行数据，否则可能发生错误
 * 
 * @param[in] pcLineData 行数据
 * @param[out] pxHexLineInfo 行信息结构体地址
 * 
 * @return 数据开始的地址
 */</span>
<span class="kt">void</span> <span class="o">*</span><span class="nf">pvHexLineParser</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">pcLineData</span><span class="p">,</span> <span class="n">xHexLineInfo_t</span> <span class="o">*</span><span class="n">pxHexLineInfo</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">char</span> <span class="n">acString</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span>

    <span class="k">if</span><span class="p">(</span> <span class="p">(</span><span class="nb">NULL</span> <span class="o">==</span> <span class="n">pcLineData</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="nb">NULL</span> <span class="o">==</span> <span class="n">pxHexLineInfo</span><span class="p">)</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cm">/* 获取 LL 字段 */</span>
    <span class="n">memset</span><span class="p">((</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="n">acString</span><span class="p">,</span> <span class="sc">'\0'</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">acString</span><span class="p">));</span>
    <span class="n">memcpy</span><span class="p">((</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="n">acString</span><span class="p">,</span> <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)(</span><span class="n">pcLineData</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">2</span><span class="p">);</span>
    <span class="n">pxHexLineInfo</span><span class="o">-&gt;</span><span class="n">u8Length</span> <span class="o">=</span> <span class="p">(</span><span class="kt">uint8_t</span><span class="p">)</span><span class="n">strtol</span><span class="p">(</span><span class="n">acString</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">16</span><span class="p">);</span>

    <span class="cm">/* 获取 AAAA 字段 */</span>
    <span class="n">memset</span><span class="p">((</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="n">acString</span><span class="p">,</span> <span class="sc">'\0'</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">acString</span><span class="p">));</span>
    <span class="n">memcpy</span><span class="p">((</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="n">acString</span><span class="p">,</span> <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)(</span><span class="n">pcLineData</span> <span class="o">+</span> <span class="mi">3</span><span class="p">),</span> <span class="mi">4</span><span class="p">);</span>
    <span class="n">pxHexLineInfo</span><span class="o">-&gt;</span><span class="n">u16Address</span> <span class="o">=</span> <span class="p">(</span><span class="kt">uint16_t</span><span class="p">)</span><span class="n">strtol</span><span class="p">(</span><span class="n">acString</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">16</span><span class="p">);</span>

    <span class="cm">/* 获取 TT 字段 */</span>
    <span class="n">memset</span><span class="p">((</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="n">acString</span><span class="p">,</span> <span class="sc">'\0'</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">acString</span><span class="p">));</span>
    <span class="n">memcpy</span><span class="p">((</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="n">acString</span><span class="p">,</span> <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)(</span><span class="n">pcLineData</span> <span class="o">+</span> <span class="mi">7</span><span class="p">),</span> <span class="mi">2</span><span class="p">);</span>
    <span class="n">pxHexLineInfo</span><span class="o">-&gt;</span><span class="n">u8RecordType</span> <span class="o">=</span> <span class="p">(</span><span class="kt">uint8_t</span><span class="p">)</span><span class="n">strtol</span><span class="p">(</span><span class="n">acString</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">16</span><span class="p">);</span>

    <span class="cm">/* 获取 CC 字段 */</span>
    <span class="n">memset</span><span class="p">((</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="n">acString</span><span class="p">,</span> <span class="sc">'\0'</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">acString</span><span class="p">));</span>
    <span class="n">memcpy</span><span class="p">((</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="n">acString</span><span class="p">,</span> <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)(</span><span class="n">pcLineData</span> <span class="o">+</span> <span class="mi">9</span> <span class="o">+</span> <span class="n">pxHexLineInfo</span><span class="o">-&gt;</span><span class="n">u8Length</span><span class="p">),</span> <span class="mi">2</span><span class="p">);</span>
    <span class="n">pxHexLineInfo</span><span class="o">-&gt;</span><span class="n">u8CheckSum</span> <span class="o">=</span> <span class="p">(</span><span class="kt">uint8_t</span><span class="p">)</span><span class="n">strtol</span><span class="p">(</span><span class="n">acString</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">16</span><span class="p">);</span>

    <span class="k">return</span> <span class="n">pcLineData</span><span class="o">+</span><span class="mi">9</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">vPrintHelp</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">pcAppName</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span><span class="p">(</span> <span class="nb">NULL</span> <span class="o">!=</span> <span class="n">pcAppName</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"Usage: %s [input file] [output file]</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">pcAppName</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
    <span class="kt">FILE</span> <span class="o">*</span><span class="n">fInput</span><span class="p">;</span>
    <span class="kt">FILE</span> <span class="o">*</span><span class="n">fOutput</span><span class="p">;</span>
    <span class="kt">size_t</span> <span class="n">xLines</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">size_t</span> <span class="n">xLineLength</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">size_t</span> <span class="n">xFileSize</span><span class="p">;</span>
    <span class="kt">char</span> <span class="n">cr</span><span class="p">;</span>
    <span class="kt">char</span> <span class="o">*</span><span class="n">pcInputFileName</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
    <span class="kt">char</span> <span class="o">*</span><span class="n">pcOutputFileName</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
    <span class="kt">char</span> <span class="o">*</span><span class="n">pcData</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
    <span class="n">xHexLineInfo_t</span> <span class="n">xHexLineInfo</span><span class="p">;</span>

    <span class="k">if</span><span class="p">(</span> <span class="mi">3</span> <span class="o">!=</span> <span class="n">argc</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">vPrintHelp</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
        <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="n">pcInputFileName</span> <span class="o">=</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
        <span class="n">pcOutputFileName</span> <span class="o">=</span> <span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"output: %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">pcOutputFileName</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">fInput</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="n">pcInputFileName</span><span class="p">,</span> <span class="s">"rb"</span><span class="p">);</span> 
    <span class="k">if</span> <span class="p">(</span><span class="n">fInput</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"Open %s error!</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">pcInputFileName</span><span class="p">);</span>
        <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">fOutput</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="n">pcOutputFileName</span><span class="p">,</span> <span class="s">"wb+"</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span> <span class="nb">NULL</span> <span class="o">==</span> <span class="n">fOutput</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">fclose</span><span class="p">(</span><span class="n">fInput</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"Open %s error!</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">pcOutputFileName</span><span class="p">);</span>
        <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="cm">/* 获取文件大小 */</span>
    <span class="n">fseek</span><span class="p">(</span><span class="n">fInput</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">SEEK_END</span><span class="p">);</span>
    <span class="n">xFileSize</span> <span class="o">=</span> <span class="n">ftell</span><span class="p">(</span><span class="n">fInput</span><span class="p">);</span>
    <span class="n">rewind</span><span class="p">(</span><span class="n">fInput</span><span class="p">);</span>

    <span class="cm">/* 统计输入文件行数 */</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">xFileSize</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">cr</span> <span class="o">=</span> <span class="n">getc</span><span class="p">(</span><span class="n">fInput</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span> <span class="sc">'\n'</span> <span class="o">==</span> <span class="n">cr</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">xLines</span><span class="o">++</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">};</span>
    <span class="n">rewind</span><span class="p">(</span><span class="n">fInput</span><span class="p">);</span>

    <span class="cm">/* 解析行信息，提取数据，以 ASCII 文本的形式储存到文件中 */</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">xLines</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">fgets</span><span class="p">(</span><span class="n">acLineData</span><span class="p">,</span> <span class="n">LINE_MAX_LENGTH</span><span class="p">,</span> <span class="n">fInput</span><span class="p">);</span>
        <span class="n">pcData</span> <span class="o">=</span> <span class="n">pvHexLineParser</span><span class="p">(</span><span class="n">acLineData</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">xHexLineInfo</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span> <span class="nb">NULL</span> <span class="o">!=</span> <span class="n">pcData</span> <span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span><span class="p">(</span> <span class="n">eData</span> <span class="o">==</span> <span class="n">xHexLineInfo</span><span class="p">.</span><span class="n">u8RecordType</span> <span class="p">)</span>
            <span class="p">{</span>
                <span class="n">fwrite</span><span class="p">(</span><span class="n">pcData</span><span class="p">,</span> <span class="mi">1</span> <span class="p">,</span> <span class="n">xHexLineInfo</span><span class="p">.</span><span class="n">u8Length</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span> <span class="n">fOutput</span><span class="p">);</span>
                <span class="n">fwrite</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fOutput</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">fclose</span><span class="p">(</span><span class="n">fInput</span><span class="p">);</span>
    <span class="n">fclose</span><span class="p">(</span><span class="n">fOutput</span><span class="p">);</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></table></code></div></div><p>例如，将 <a href="https://developer.arm.com/documentation/ka003292/latest">[1]</a> 中给出的示例文件的如下内容保存在 <code class="language-plaintext highlighter-rouge">test.hex</code> 文件中：</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>:10001300AC12AD13AE10AF1112002F8E0E8F0F2244
:10000300E50B250DF509E50A350CF5081200132259
:03000000020023D8
:0C002300787FE4F6D8FD7581130200031D
:10002F00EFF88DF0A4FFEDC5F0CEA42EFEEC88F016
:04003F00A42EFE22CB
:00000001FF
</pre></table></code></div></div><p>将前述代码编译为二进制文件，例如 <code class="language-plaintext highlighter-rouge">hex_tool.exe</code>，使用该程序提取数据，输出到 <code class="language-plaintext highlighter-rouge">test.txt</code> 文件中：</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>./hex_tool.exe test.hex test.txt
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">test.txt</code> 文件中的内容如下：</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>AC12AD13AE10AF1112002F8E0E8F0F22
E50B250DF509E50A350CF50812001322
020023
787FE4F6D8FD758113020003
EFF88DF0A4FFEDC5F0CEA42EFEEC88F0
A42EFE22
</pre></table></code></div></div><h3 id="2-提取-bin-文件内的数据">(2) 提取 BIN 文件内的数据</h3><p>下面的这段代码，是从编译生成的 BIN 文件中读取数据，按每行 16 个十六进制字符的形式输出到指定的文件中：</p><div class="language-c highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
</pre><td class="rouge-code"><pre><span class="cm">/**
 * @file bin_tool.c
 * @author qianchenzhumeng (qianchenzhumeng@live.cn)
 * @brief 读取 BIN 文件内容，以 ASCII 文本的形式输出到指定文件中。
 * @version 0.1
 * @date 2022-02-12
 * 
 * @copyright Copyright (c) 2022 qianchenzhumeng
 * 
 */</span>
<span class="cp">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
#include &lt;stdint.h&gt;
</span>
<span class="kt">void</span> <span class="nf">vPrintHelp</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">pcAppName</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span><span class="p">(</span> <span class="nb">NULL</span> <span class="o">!=</span> <span class="n">pcAppName</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"Usage: %s [input file] [output file]</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">pcAppName</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
    <span class="kt">FILE</span> <span class="o">*</span><span class="n">fInput</span><span class="p">;</span>
    <span class="kt">FILE</span> <span class="o">*</span><span class="n">fOutput</span><span class="p">;</span>
    <span class="kt">char</span> <span class="n">cr</span> <span class="o">=</span> <span class="sc">'\0'</span><span class="p">;</span>
    <span class="kt">uint8_t</span> <span class="n">aucChar</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">};</span>
    <span class="kt">uint8_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">size_t</span> <span class="n">xFileSize</span><span class="p">;</span>

    <span class="kt">char</span> <span class="o">*</span><span class="n">pcInputFileName</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
    <span class="kt">char</span> <span class="o">*</span><span class="n">pcOutputFileName</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
    <span class="kt">char</span> <span class="o">*</span><span class="n">pcData</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>

    <span class="k">if</span><span class="p">(</span> <span class="mi">3</span> <span class="o">!=</span> <span class="n">argc</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">vPrintHelp</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
        <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="n">pcInputFileName</span> <span class="o">=</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
        <span class="n">pcOutputFileName</span> <span class="o">=</span> <span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"output: %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">pcOutputFileName</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">fInput</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="n">pcInputFileName</span><span class="p">,</span> <span class="s">"rb"</span><span class="p">);</span> 
    <span class="k">if</span> <span class="p">(</span><span class="n">fInput</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"Open %s error!</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">pcInputFileName</span><span class="p">);</span>
        <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">fOutput</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="n">pcOutputFileName</span><span class="p">,</span> <span class="s">"wb+"</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span> <span class="nb">NULL</span> <span class="o">==</span> <span class="n">fOutput</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">fclose</span><span class="p">(</span><span class="n">fInput</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"Open %s error!</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">pcOutputFileName</span><span class="p">);</span>
        <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="cm">/* 获取文件大小 */</span>
    <span class="n">fseek</span><span class="p">(</span><span class="n">fInput</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">SEEK_END</span><span class="p">);</span>
    <span class="n">xFileSize</span> <span class="o">=</span> <span class="n">ftell</span><span class="p">(</span><span class="n">fInput</span><span class="p">);</span>
    <span class="n">rewind</span><span class="p">(</span><span class="n">fInput</span><span class="p">);</span>

    <span class="k">for</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">xFileSize</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">cr</span> <span class="o">=</span> <span class="n">getc</span><span class="p">(</span><span class="n">fInput</span><span class="p">);</span>
        <span class="n">snprintf</span><span class="p">(</span><span class="n">aucChar</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">aucChar</span><span class="p">),</span><span class="s">"%02X"</span><span class="p">,</span> <span class="p">(</span><span class="kt">uint8_t</span><span class="p">)</span><span class="n">cr</span><span class="p">);</span>
        <span class="n">fwrite</span><span class="p">(</span><span class="n">aucChar</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fOutput</span><span class="p">);</span>
        <span class="c1">//printf("%02X", (uint8_t)cr);</span>
        <span class="k">if</span><span class="p">(</span> <span class="p">(</span><span class="mi">0</span> <span class="o">!=</span> <span class="n">i</span><span class="p">)</span>  <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="mi">15</span><span class="p">)</span> <span class="p">)</span>
        <span class="p">{</span>
            <span class="n">fwrite</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fOutput</span><span class="p">);</span>
            <span class="c1">//printf("\n");</span>
            <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span>
        <span class="p">{</span>
            <span class="n">i</span><span class="o">++</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">fwrite</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fOutput</span><span class="p">);</span>

    <span class="n">fclose</span><span class="p">(</span><span class="n">fInput</span><span class="p">);</span>
    <span class="n">fclose</span><span class="p">(</span><span class="n">fOutput</span><span class="p">);</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></table></code></div></div><p>将前述代码编译为二进制文件，例如 <code class="language-plaintext highlighter-rouge">bin_tool.exe</code>，使用该程序提取 <code class="language-plaintext highlighter-rouge">test.bin</code> 中的数据，输出到 <code class="language-plaintext highlighter-rouge">test.txt</code> 文件中：</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>./bin_tool.exe test.bin test.txt
</pre></table></code></div></div><h2 id="4-实例">4. 实例</h2><p>以背景中介绍的情况为例，调试时，在 Keil 的命令窗口内通过如下命令，将下载缓冲区内的内容输出到 <code class="language-plaintext highlighter-rouge">buffer.hex</code> 文件中：</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>SAVE tools\buffer.hex 0x20001000,0x2000D34F
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">SAVE</code> 命令的具体使用方式见<a href="https://www.keil.com/support/man/docs/uv4cl/uv4cl_cm_save.htm">[2]</a>。</p><p>使用 <code class="language-plaintext highlighter-rouge">hex_tool.exe</code> 提取 <code class="language-plaintext highlighter-rouge">buffer.hex</code> 中的内容，保存到 <code class="language-plaintext highlighter-rouge">buffer.txt</code> 中：</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>./hex_tool.exe buffer.hex buffer.txt
</pre></table></code></div></div><p>使用 <code class="language-plaintext highlighter-rouge">hex_tool.exe</code> 提取版本文件中的内容，保存到 <code class="language-plaintext highlighter-rouge">bin.txt</code> 中：</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="c"># 假设编译生成的文件为 test.hex 和 test.bin，二者包含的数据是相同的，提取其中一个的数据即可</span>
./hex_tool.exe test.hex bin.txt
./bin_tool.exe test.bin bin.txt
</pre></table></code></div></div><p>之后，使用比较工具比较 <code class="language-plaintext highlighter-rouge">buffer.txt</code> 和 <code class="language-plaintext highlighter-rouge">bin.txt</code> 即可。</p><h2 id="参考">参考</h2><p>[1] <a href="https://developer.arm.com/documentation/ka003292/latest">GENERAL: Inter HEX File Format</a></p><p>[2] <a href="https://www.keil.com/support/man/docs/uv4cl/uv4cl_cm_save.htm">uVersion User’s Guide: SAVE</a></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/embedded/'>Embedded</a>, <a href='/categories/mcu/'>MCU</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/keil/" class="post-tag no-text-decoration" >Keil</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Keil HEX 文件格式解析及数据提取 - 前尘逐梦&url=https://qianchenzhumeng.github.io/posts/keil_hex_file_format/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Keil HEX 文件格式解析及数据提取 - 前尘逐梦&u=https://qianchenzhumeng.github.io/posts/keil_hex_file_format/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Keil HEX 文件格式解析及数据提取 - 前尘逐梦&url=https://qianchenzhumeng.github.io/posts/keil_hex_file_format/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://qianchenzhumeng.github.io/posts/keil_hex_file_format/" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <a href="http://service.weibo.com/share/share.php?title=Keil HEX 文件格式解析及数据提取 - 前尘逐梦&url=https://qianchenzhumeng.github.io/posts/keil_hex_file_format/" data-toggle="tooltip" data-placement="top" title="Weibo" target="_blank" rel="noopener" aria-label="Weibo"> <i class="fa-fw fab fa-weibo"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/mq-r-f133_develop_guide/">芒果派 MQ-R F133 开发指南</a><li><a href="/posts/gui_development_with_rust_and_gtk4_on_windows/">Windows 下使用 Rust 和 GTK4 创建 GUI 程序</a><li><a href="/posts/modern_robotics_mechanics_planning_and_Control/">Modern Robotics: Mechanics, Planning, and Control</a><li><a href="/posts/rust_notes/">Rust 笔记</a><li><a href="/posts/generate_manufacturing_data_from_eagle/">Eagle 输出 PCB 制造数据</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/mqtt/">MQTT</a> <a class="post-tag" href="/tags/openwrt/">OpenWrt</a> <a class="post-tag" href="/tags/rust/">Rust</a> <a class="post-tag" href="/tags/thingsboard/">ThingsBoard</a> <a class="post-tag" href="/tags/contiki/">Contiki</a> <a class="post-tag" href="/tags/esp8266/">ESP8266</a> <a class="post-tag" href="/tags/stm8/">STM8</a> <a class="post-tag" href="/tags/inventory-management/">Inventory Management</a> <a class="post-tag" href="/tags/iot/">IoT</a> <a class="post-tag" href="/tags/other/">Other</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/IAR%E7%BC%96%E8%AF%91ZStack-CC2530%E7%94%9F%E6%88%90HEX%E6%96%87%E4%BB%B6/"><div class="card-body"> <span class="timeago small" > Aug 25, 2015 <i class="unloaded">2015-08-25T00:11:26+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>IAR 编译 ZStack-CC2530 生成 HEX 文件</h3><div class="text-muted small"><p> IAR 编译 ZStack-CC2530 为可下载运行的 HEX 文件的正确配置： 正确配置输出文件格式：菜单选择Project－Options－Linker－Output－Format，选择Other。右边的Output下拉框选intel-extended，Format variant下拉框选None，Module-local下拉框选Include all ...</p></div></div></a></div><div class="card"> <a href="/posts/STM8%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/"><div class="card-body"> <span class="timeago small" > Jun 14, 2016 <i class="unloaded">2016-06-14T10:23:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>STM8 开发环境搭建</h3><div class="text-muted small"><p> (1) 下载ST Visual develop IDE 到ST官网上搜索STVD，列表中选择“STVD-STM8”下载安装即可。 (2) 安装CXSTM8 访问http://www.cosmicsoftware.com/，填写注册信息后下载，安装过程中按照指引发送电子邮件申请“license.lic”，大概一天左右可以收到。 如果是使用过程中许可证过期，需要运行安装目录下的COSMIC...</p></div></div></a></div><div class="card"> <a href="/posts/sdcc-for-contiki/"><div class="card-body"> <span class="timeago small" > Dec 23, 2016 <i class="unloaded">2016-12-23T09:41:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>SDCC for Contiki</h3><div class="text-muted small"><p> 1. 背景 平台：CC2530F256 系统环境：InstantContiki2.7 Ubuntu 12.04 32bit 2. 安装前的准备 $ sudo apt-get install libboost-graph-dev srecord 下载SDCC源码后，需要对源码进行一些修改： 编辑“device/lib/incl.mk”，找到103行的： MODELS = sma...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/send_a_usb_control_transfer_to_hub_using_libusb_on_windows/" class="btn btn-outline-primary" prompt="Older"><p>使用 libusb 发送控制传输</p></a> <a href="/posts/gui_development_with_rust_and_gtk4_on_windows/" class="btn btn-outline-primary" prompt="Newer"><p>Windows 下使用 Rust 和 GTK4 创建 GUI 程序</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://github.com/qianchenzhumeng">前尘逐梦</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/mqtt/">MQTT</a> <a class="post-tag" href="/tags/openwrt/">OpenWrt</a> <a class="post-tag" href="/tags/rust/">Rust</a> <a class="post-tag" href="/tags/thingsboard/">ThingsBoard</a> <a class="post-tag" href="/tags/contiki/">Contiki</a> <a class="post-tag" href="/tags/esp8266/">ESP8266</a> <a class="post-tag" href="/tags/stm8/">STM8</a> <a class="post-tag" href="/tags/inventory-management/">Inventory Management</a> <a class="post-tag" href="/tags/iot/">IoT</a> <a class="post-tag" href="/tags/other/">Other</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script> var _hmt = _hmt || []; (function() { var hm = document.createElement("script"); hm.src = "https://hm.baidu.com/hm.js?0dfbba74f4bbf4feedaaf402fbae1dd8"; var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s); })(); </script> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://qianchenzhumeng.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
